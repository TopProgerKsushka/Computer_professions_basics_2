ORG 000
BACK: WORD ?
BR 010

ORG 010
HLT
MOV SAVED_A
ROL	
MOV SAVED_C
BR CHECK1

ORG 004
X: WORD ?
ONE: WORD 0001
XMAX: WORD 0015
XMIN: WORD FFEB 
SAVED_A: WORD ?
SAVED_C: WORD ?
TMP: WORD ?
SIGNMASK: WORD 0080

ORG 100
BEGIN: EI
CYCLE: 
CLA
DI
ADD X
ADD ONE
JSR CHECK
EI
MOV X
BR CYCLE

CHECK:
WORD ?
SUB XMIN
BMI REPAIR
ADD XMIN
SUB XMAX
BPL REPAIR
ADD XMAX
BR (CHECK)

REPAIR:
CLA
ADD XMIN
BR (CHECK)

ORG 200
CHECK1:
TSF 1
BR CHECK3
CLA	
ADD X
CLC
ROL
CLC
ADD X
CLC
ROL
CLC
OUT 1
CLF 1
BR RETURN

CHECK3: 
TSF 3
BR CLEAR
CLA
IN 3
CLF 3
MOV TMP
AND SIGNMASK
BEQ POSITIVE
CLA
CMA
AND TMP
BR NEXT

POSITIVE:
ADD TMP

NEXT:
AND X
JSR CHECK
MOV X
BR RETURN

CLEAR:
CLF 0
CLF 2
CLF 4
CLF 5
CLF 6
CLF 7
CLF 8
CLF 9

RETURN:
CLA
ADD SAVED_C
ROR
CLA
CMA
AND SAVED_A
HLT
EI
BR (BACK)
